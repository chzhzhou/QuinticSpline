#include "stdafx.h"
#include "numeric.h"



double(**Numeric::N[3])(double) = { Numeric::N0 ,Numeric::N1, Numeric::N2 };
double(*Numeric::N0[1])(double) = { Numeric::N00 };
double(*Numeric::N1[2])(double) = { Numeric::N10, Numeric::N11 };
double(*Numeric::N2[3])(double) = { Numeric::N20, Numeric::N21, Numeric::N22 };
double Numeric::N00(double x) { return 0; }
double Numeric::N10(double x) { return 1. - x; }
double Numeric::N11(double x) { return x; }
double Numeric::N20(double x) { return (1. - x) * (1. - 2. * x); }
double Numeric::N21(double x) { return 4. * x * (1. - x); }
double Numeric::N22(double x) { return x * (2. * x - 1.); }

const double* Numeric::qd[21] = { qd1, qd1, qd2, qd3, qd4, qd5, qd6, qd7, qd8, qd9, qd10, qd11, qd12, qd13, qd14, qd15, qd16, qd17, qd18, qd19, qd20 };
const double* Numeric::lqd[5] = { lqd1, lqd1, lqd2, lqd3, lqd4 };

const double Numeric::qd1[2] = { 0.5000000000000000, 1.0000000000000000 };
const double Numeric::qd2[4] = { 0.2113248654051871, 0.5000000000000000, 0.7886751345948129, 0.5000000000000000 };
const double Numeric::qd3[6] = { 0.1127016653792583, 0.2777777777777778, 0.5000000000000000, 0.4444444444444445, 0.8872983346207420, 0.2777777777777778 };
const double Numeric::qd4[8] = { 0.0694318442029737, 0.1739274225687269, 0.3300094782075718, 0.3260725774312730, 0.6699905217924282, 0.3260725774312730, 0.9305681557970260, 0.1739274225687269 };
const double Numeric::qd5[10] = { 0.0469100770306680, 0.1184634425280946, 0.2307653449471585, 0.2393143352496832, 0.5000000000000000, 0.2844444444444445, 0.7692346550528415, 0.2393143352496832, 0.9530899229693320, 0.1184634425280946 };
const double Numeric::qd6[12] = { 0.0337652428984240, 0.0856622461895852, 0.1693953067668677, 0.1803807865240693, 0.3806904069584016, 0.2339569672863455, 0.6193095930415985, 0.2339569672863455, 0.8306046932331320, 0.1803807865240693, 0.9662347571015760, 0.0856622461895852 };
const double Numeric::qd7[14] = { 0.0254460438286207, 0.0647424830844349, 0.1292344072003028, 0.1398526957446383, 0.2970774243113014, 0.1909150252525595, 0.5000000000000000, 0.2089795918367347, 0.7029225756886985, 0.1909150252525595, 0.8707655927996970, 0.1398526957446383, 0.9745539561713790, 0.0647424830844349 };
const double Numeric::qd8[16] = { 0.0198550717512319, 0.0506142681451881, 0.1016667612931866, 0.1111905172266872, 0.2372337950418355, 0.1568533229389436, 0.4082826787521751, 0.1813418916891810, 0.5917173212478249, 0.1813418916891810, 0.7627662049581645, 0.1568533229389436, 0.8983332387068130, 0.1111905172266872, 0.9801449282487680, 0.0506142681451881 };
const double Numeric::qd9[18] = { 0.0159198802461870, 0.0406371941807872, 0.0819844463366821, 0.0903240803474287, 0.1933142836497048, 0.1303053482014677, 0.3378732882980955, 0.1561735385200014, 0.5000000000000000, 0.1651196775006299, 0.6621267117019045, 0.1561735385200014, 0.8066857163502950, 0.1303053482014677, 0.9180155536633180, 0.0903240803474287, 0.9840801197538130, 0.0406371941807872 };
const double Numeric::qd10[20] = { 0.0130467357414141, 0.0333356721543441, 0.0674683166555077, 0.0747256745752903, 0.1602952158504878, 0.1095431812579910, 0.2833023029353764, 0.1346333596549982, 0.4255628305091844, 0.1477621123573764, 0.5744371694908156, 0.1477621123573764, 0.7166976970646236, 0.1346333596549982, 0.8397047841495120, 0.1095431812579910, 0.9325316833444920, 0.0747256745752903, 0.9869532642585860, 0.0333356721543441 };
const double Numeric::qd11[22] = { 0.0108856709269715, 0.0278342835580868, 0.0564687001159524, 0.0627901847324523, 0.1349239972129753, 0.0931451054638671, 0.2404519353965941, 0.1165968822959953, 0.3652284220238275, 0.1314022722551233, 0.5000000000000000, 0.1364625433889503, 0.6347715779761725, 0.1314022722551233, 0.7595480646034059, 0.1165968822959953, 0.8650760027870250, 0.0931451054638671, 0.9435312998840480, 0.0627901847324523, 0.9891143290730290, 0.0278342835580868 };
const double Numeric::qd12[24] = { 0.0092196828766404, 0.0235876681932559, 0.0479413718147626, 0.0534696629976592, 0.1150486629028477, 0.0800391642716731, 0.2063410228566913, 0.1015837133615330, 0.3160842505009099, 0.1167462682691774, 0.4373832957442655, 0.1245735229067014, 0.5626167042557345, 0.1245735229067014, 0.6839157494990901, 0.1167462682691774, 0.7936589771433087, 0.1015837133615330, 0.8849513370971520, 0.0800391642716731, 0.9520586281852370, 0.0534696629976592, 0.9907803171233600, 0.0235876681932559 };
const double Numeric::qd13[26] = { 0.0079084726407059, 0.0202420023826579, 0.0412008003885110, 0.0460607499188642, 0.0992109546333450, 0.0694367551098936, 0.1788253302798299, 0.0890729903809729, 0.2757536244817766, 0.1039080237684443, 0.3847708420224326, 0.1131415901314486, 0.5000000000000000, 0.1162757766154370, 0.6152291579775674, 0.1131415901314486, 0.7242463755182235, 0.1039080237684443, 0.8211746697201700, 0.0890729903809729, 0.9007890453666550, 0.0694367551098936, 0.9587991996114890, 0.0460607499188642, 0.9920915273592940, 0.0202420023826579 };
const double Numeric::qd14[28] = { 0.0068580956515938, 0.0175597301658759, 0.0357825581682132, 0.0400790435798801, 0.0863993424651175, 0.0607592853439516, 0.1563535475941573, 0.0786015835790968, 0.2423756818209229, 0.0927691987389689, 0.3404438155360551, 0.1025992318606478, 0.4459725256463281, 0.1076319267315789, 0.5540274743536719, 0.1076319267315789, 0.6595561844639449, 0.1025992318606478, 0.7576243181790771, 0.0927691987389689, 0.8436464524058430, 0.0786015835790968, 0.9136006575348830, 0.0607592853439516, 0.9642174418317870, 0.0400790435798801, 0.9931419043484060, 0.0175597301658759 };
const double Numeric::qd15[30] = { 0.0060037409897573, 0.0153766209980586, 0.0313633037996471, 0.0351830237440541, 0.0758967082947864, 0.0535796102335860, 0.1377911343199150, 0.0697853389630772, 0.2145139136957306, 0.0831346029084970, 0.3029243264612183, 0.0930805000077811, 0.3994029530012828, 0.0992157426635558, 0.5000000000000000, 0.1012891209627806, 0.6005970469987173, 0.0992157426635558, 0.6970756735387816, 0.0930805000077811, 0.7854860863042694, 0.0831346029084970, 0.8622088656800850, 0.0697853389630772, 0.9241032917052140, 0.0535796102335860, 0.9686366962003530, 0.0351830237440541, 0.9939962590102430, 0.0153766209980586 };
const double Numeric::qd16[32] = { 0.0052995325041750, 0.0135762297058771, 0.0277124884633837, 0.0311267619693239, 0.0671843988060841, 0.0475792558412464, 0.1222977958224985, 0.0623144856277669, 0.1910618777986781, 0.0747979944082884, 0.2709916111713863, 0.0845782596975013, 0.3591982246103705, 0.0913017075224618, 0.4524937450811813, 0.0947253052275343, 0.5475062549188188, 0.0947253052275343, 0.6408017753896295, 0.0913017075224618, 0.7290083888286137, 0.0845782596975013, 0.8089381222013220, 0.0747979944082884, 0.8777022041775020, 0.0623144856277669, 0.9328156011939160, 0.0475792558412464, 0.9722875115366160, 0.0311267619693239, 0.9947004674958250, 0.0135762297058771 };
const double Numeric::qd17[34] = { 0.0047122623427913, 0.0120741514342740, 0.0246622391156161, 0.0277297646869936, 0.0598804231365071, 0.0425180741585896, 0.1092429980515993, 0.0559419235967020, 0.1711644203916546, 0.0675681842342627, 0.2436547314567615, 0.0770228805384051, 0.3243841182730618, 0.0840020510782250, 0.4107579092520760, 0.0882813526834963, 0.5000000000000000, 0.0897232351781033, 0.5892420907479239, 0.0882813526834963, 0.6756158817269382, 0.0840020510782250, 0.7563452685432384, 0.0770228805384051, 0.8288355796083450, 0.0675681842342627, 0.8907570019484010, 0.0559419235967020, 0.9401195768634930, 0.0425180741585896, 0.9753377608843840, 0.0277297646869936, 0.9952877376572090, 0.0120741514342740 };
const double Numeric::qd18[36] = { 0.0042174157895345, 0.0108080067632417, 0.0220880252143011, 0.0248572744474849, 0.0536987667512221, 0.0382128651274445, 0.0981475205137384, 0.0504710220531436, 0.1541564784698234, 0.0612776033557392, 0.2201145844630262, 0.0703214573353253, 0.2941244192685787, 0.0773423375631326, 0.3740568871542473, 0.0821382418729164, 0.4576124934791324, 0.0845711914815718, 0.5423875065208676, 0.0845711914815718, 0.6259431128457527, 0.0821382418729164, 0.7058755807314213, 0.0773423375631326, 0.7798854155369738, 0.0703214573353253, 0.8458435215301770, 0.0612776033557392, 0.9018524794862620, 0.0504710220531436, 0.9463012332487780, 0.0382128651274445, 0.9779119747856990, 0.0248572744474849, 0.9957825842104650, 0.0108080067632417 };
const double Numeric::qd19[38] = { 0.0037965780782078, 0.0097308941148632, 0.0198959239325850, 0.0224071133828498, 0.0484220481925911, 0.0345222713688206, 0.0886426717314286, 0.0457450108112250, 0.1395169113323853, 0.0557833227736670, 0.1997273476691595, 0.0643769812696681, 0.2677146293120195, 0.0713033510868033, 0.3417179500181851, 0.0763830210329298, 0.4198206771798873, 0.0794844216969772, 0.5000000000000000, 0.0805272249243919, 0.5801793228201126, 0.0794844216969772, 0.6582820499818149, 0.0763830210329298, 0.7322853706879805, 0.0713033510868033, 0.8002726523308410, 0.0643769812696681, 0.8604830886676150, 0.0557833227736670, 0.9113573282685710, 0.0457450108112250, 0.9515779518074090, 0.0345222713688206, 0.9801040760674150, 0.0224071133828498, 0.9962034219217920, 0.0097308941148632 };
const double Numeric::qd20[40] = { 0.0034357004074525, 0.0088070035695761, 0.0180140363610431, 0.0203007149001935, 0.0438827858743371, 0.0313360241670545, 0.0804415140888906, 0.0416383707883524, 0.1268340467699246, 0.0509650599086202, 0.1819731596367425, 0.0590972659807592, 0.2445664990245865, 0.0658443192245883, 0.3131469556422902, 0.0710480546591910, 0.3861070744291775, 0.0745864932363019, 0.4617367394332513, 0.0763766935653629, 0.5382632605667487, 0.0763766935653629, 0.6138929255708225, 0.0745864932363019, 0.6868530443577098, 0.0710480546591910, 0.7554335009754135, 0.0658443192245883, 0.8180268403632580, 0.0590972659807592, 0.8731659532300750, 0.0509650599086202, 0.9195584859111090, 0.0416383707883524, 0.9561172141256630, 0.0313360241670545, 0.9819859636389570, 0.0203007149001935, 0.9965642995925470, 0.0088070035695761 };


const double Numeric::lqd1[10] = { 0.291344721519721E-1, 0.297893471782894, 0.173977213320898, 0.349776226513224, 0.411702520284902, 0.234488290044052, 0.677314174582820, 0.989304595166331E-1, 0.894771361031008, 0.189115521431958E-1 };
const double Numeric::lqd2[20] = { 0.904263096219965064E-2, 0.120955131954570515, 0.539712662225006295E-1, 0.186363542564071870, 0.135311824639250775, 0.195660873277759983, 0.247052416287159824, 0.173577142182906921, 0.380212539609332334, 0.135695672995484202, 0.523792317971843201, 0.936467585381105260E-1, 0.665775205516424597, 0.557877273514158741E-1, 0.794190416011966217, 0.271598108992333311E-1, 0.898161091219003538, 0.951518260284851500E-2, 0.968847988718633539, 0.163815763359826325E-2 };
const double Numeric::lqd3[30] = { 0.438311017547540383485E-2, 0.670099789164937136032E-1, 0.259358981053306161023E-1, 0.112264150286705741828, 0.655960954123162452541E-1, 0.131760177039679903732, 0.122101934073331603330, 0.135217649061934725132, 0.193395262374007115983, 0.127881798645680370401, 0.276772838706102024394, 0.113532907490219421290, 0.369015127139742943816, 0.952052397843586585116E-1, 0.466524328964706582676, 0.753893141673959543393E-1, 0.565473473791817306425, 0.560784244926537179923E-1, 0.661962919012456421390, 0.387682953750182311100E-1, 0.752178883378785798788, 0.244514832687500759604E-1, 0.832548033866189589257, 0.136246301382388469054E-1, 0.899882050120898084330, 0.631644759859076119983E-2, 0.951506188743409902726, 0.213888991594447134783E-2, 0.985364468122131938927, 0.360613818335406646851E-3 };
const double Numeric::lqd4[40] = { 0.258832795592195542833E-2, 0.431427521332080785790E-1, 0.152096623495602317207E-1, 0.753837099085893595505E-1, 0.385365503721653279598E-1, 0.930532674516630513727E-1, 0.721816138158739064350E-1, 0.101456711849829754437, 0.115460526487633150559, 0.103201762056072069058, 0.167442856275329685718, 0.100022549805273166533, 0.226983787260202503361, 0.932597993002976780837E-1, 0.292754960941545832992, 0.840289528719410564971E-1, 0.363277429857858904538, 0.732855891300307409628E-1, 0.436957140090768318487, 0.618503369137302899572E-1, 0.512122594678967336196, 0.504166044383746776371E-1, 0.587064044914409915132, 0.395513700052983853329E-1, 0.660073413314909413912, 0.296940778958128448046E-1, 0.729484083929687498871, 0.211563153554270976730E-1, 0.793709671987085817744, 0.141237329389640204366E-1, 0.851280892789125727222, 0.866097450433549862823E-2, 0.900879680854417594223, 0.471994014620360495437E-2, 0.941369749129091676303, 0.215139740396520611468E-2, 0.971822741075263193738, 0.719728214653202646358E-3, 0.991538081438711972652, 0.120427676330216741693E-3 };


void Numeric::KEPQ(double m, double &K, double &E, double &KP, double &KQ, double &EP, double &EQ) {
	KP = ellipKP[0];
	KQ = ellipKQ[0];
	EP = ellipEP[0];
	EQ = ellipEQ[0];
	double m1 = 1. - m;
	for (int k = 1; k <= 10; k++) {
		double m1k = pow(m1, k);
		KP += ellipKP[k] * m1k;
		KQ += ellipKQ[k] * m1k;
		EP += ellipEP[k] * m1k;
		EQ += ellipEQ[k] * m1k;
	}
	K = KP - log(1. - m) * KQ;
	E = EP - log(1. - m) * EQ;
}

void Numeric::KEPQ(double m, double &K, double &E) {
	double KP = ellipKP[0], KQ = ellipKQ[0], EP = ellipEP[0], EQ = ellipEQ[0];
	double m1 = 1. - m;
	for (int k = 1; k <= 10; k++) {
		double m1k = pow(m1, k);
		KP += ellipKP[k] * m1k;
		KQ += ellipKQ[k] * m1k;
		EP += ellipEP[k] * m1k;
		EQ += ellipEQ[k] * m1k;
	}
	K = KP - log(1. - m) * KQ;
	E = EP - log(1. - m) * EQ;
}

const double Numeric::ellipKP[11] = { 1.38629436111989062502E0,9.65735902811690126535E-2,3.08851465246711995998E-2,1.49380448916805252718E-2,8.79078273952743772254E-3,6.18901033637687613229E-3,6.87489687449949877925E-3,9.85821379021226008714E-3,7.97404013220415179367E-3,2.28025724005875567385E-3,1.37982864606273237150E-4 };
const double Numeric::ellipKQ[11] = { 4.99999999999999999821E-1,1.24999999999870820058E-1,7.03124996963957469739E-2,4.88280347570998239232E-2,3.73774314173823228969E-2,3.01204715227604046988E-2,2.39089602715924892727E-2,1.54850516649762399335E-2,5.94058303753167793257E-3,9.14184723865917226571E-4,2.94078955048598507511E-5 };
const double Numeric::ellipEP[11] = { 1.00000000000000000299E0,4.43147180560990850618E-1,5.68051945617860553470E-2,2.18317996015557253103E-2,1.15688436810574127319E-2,7.58395289413514708519E-3,7.77395492516787092951E-3,1.07350949056076193403E-2,8.68786816565889628429E-3,2.50888492163602060990E-3,1.53552577301013293365E-4 };
const double Numeric::ellipEQ[11] = { 0.0,2.49999999999888314361E-1,9.37499997197644278445E-2,5.85936634471101055642E-2,4.27180926518931511717E-2,3.34833904888224918614E-2,2.61769742454493659583E-2,1.68862163993311317300E-2,6.50609489976927491433E-3,1.00962792679356715133E-3,3.27954898576485872656E-5 };